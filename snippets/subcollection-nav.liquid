{%- comment -%}
  Subcollection Sidebar Navigation
  Renders as left sidebar with linked collections from metafields
  First metafield (subcollections) always labeled "Type"
  Additional metafields labeled by last word of key (e.g. subcollections_brands → "Brands")
  Only renders if at least one metafield has values
{%- endcomment -%}

{%- liquid
  assign subcollections = collection.metafields.custom.subcollections.value
  assign subcollections_brands = collection.metafields.custom.subcollections_brands.value
-%}

{% if subcollections != blank or subcollections_brands != blank %}
  <aside class="subcollection-sidebar">

    {% if subcollections != blank %}
      <div class="subcollection-sidebar__group">
        <h3 class="subcollection-sidebar__heading">Type</h3>
        <ul class="subcollection-sidebar__list">
          {% for subcol in subcollections %}
            <li>
              <a href="{{ subcol.url }}" class="subcollection-sidebar__link {% if request.path == subcol.url %}is-active{% endif %}">
                {{ subcol.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% if subcollections_brands != blank %}
      <div class="subcollection-sidebar__group">
        <h3 class="subcollection-sidebar__heading">Brands</h3>
        <ul class="subcollection-sidebar__list">
          {% for subcol in subcollections_brands %}
            <li>
              <a href="{{ subcol.url }}" class="subcollection-sidebar__link {% if request.path == subcol.url %}is-active{% endif %}">
                {{ subcol.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

  </aside>
{% endif %}

{% style %}
  /* Sidebar container — sits left of product grid */
  .subcollection-sidebar {
    grid-column: 1;
    grid-row: 1 / -1;
    padding: 0 1.5rem 1rem 0;
    position: sticky;
    top: 2rem;
    align-self: start;
    min-width: 180px;
    max-width: 220px;
  }

  /* When sidebar is present, make collection-wrapper a 2-col grid */
  .collection-wrapper:has(.subcollection-sidebar) {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 0;
  }

  /* Push product grid and pagination into column 2 */
  .collection-wrapper:has(.subcollection-sidebar) .main-collection-grid,
  .collection-wrapper:has(.subcollection-sidebar) .pagination-wrapper {
    grid-column: 2;
  }

  .subcollection-sidebar__group {
    margin-bottom: 1.5rem;
  }

  .subcollection-sidebar__heading {
    font-size: 0.85rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    margin: 0 0 0.75rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(0,0,0,0.1);
  }

  .subcollection-sidebar__list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .subcollection-sidebar__link {
    display: block;
    padding: 0.4rem 0.6rem;
    font-size: 0.85rem;
    text-decoration: none;
    border-radius: 4px;
    transition: background 0.15s;
    color: inherit;
  }

  .subcollection-sidebar__link:hover {
    background: rgba(0,0,0,0.04);
  }

  .subcollection-sidebar__link.is-active {
    font-weight: 600;
    background: rgba(0,0,0,0.06);
  }

  /* Mobile: collapse sidebar above grid */
  @media (max-width: 749px) {
    .collection-wrapper:has(.subcollection-sidebar) {
      grid-template-columns: 1fr;
    }
    .collection-wrapper:has(.subcollection-sidebar) .main-collection-grid,
    .collection-wrapper:has(.subcollection-sidebar) .pagination-wrapper {
      grid-column: 1;
    }
    .subcollection-sidebar {
      position: static;
      max-width: none;
      padding: 0 0 1rem 0;
      border-bottom: 1px solid rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }
    .subcollection-sidebar__list {
      flex-direction: row;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .subcollection-sidebar__link {
      padding: 0.4rem 0.8rem;
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 2rem;
    }
  }
{% endstyle %}
